# 🏗️ Архитектура SUPFLOT

## 📐 Общая архитектура

SUPFLOT - это платформа-агрегатор для аренды сапбордов, похожая на Авито, но специализированная для SUP-индустрии.

### Компоненты системы

```
┌─────────────────────────────────────────────────────────┐
│                    FRONTEND LAYER                       │
├─────────────────────────────────────────────────────────┤
│  Telegram Bot  │  Web Site  │  Mobile App (future)     │
└─────────────────────────────────────────────────────────┘
                          │
┌─────────────────────────────────────────────────────────┐
│                    API LAYER                            │
├─────────────────────────────────────────────────────────┤
│  REST API  │  WebSocket  │  Telegram Bot API           │
└─────────────────────────────────────────────────────────┘
                          │
┌─────────────────────────────────────────────────────────┐
│                    BUSINESS LOGIC                       │
├─────────────────────────────────────────────────────────┤
│  Booking Service  │  Payment Service  │  Partner API   │
│  Notification Svc  │  Weather Service   │  Review Svc    │
└─────────────────────────────────────────────────────────┘
                          │
┌─────────────────────────────────────────────────────────┐
│                    DATA LAYER                           │
├─────────────────────────────────────────────────────────┤
│  SQLite (dev) / PostgreSQL (prod)  │  Redis (cache)    │
└─────────────────────────────────────────────────────────┘
                          │
┌─────────────────────────────────────────────────────────┐
│                    EXTERNAL SERVICES                     │
├─────────────────────────────────────────────────────────┤
│  ЮKassa  │  Telegram  │  OpenWeather  │  Maps API       │
└─────────────────────────────────────────────────────────┘
```

## 🎯 Модель данных

### Основные сущности

1. **Users** - Пользователи платформы
2. **Partners** - Партнерские точки (как водители в Яндекс Такси)
3. **Locations** - Локации аренды
4. **Boards** - Сапборды (инвентарь партнеров)
5. **Bookings** - Бронирования
6. **Reviews** - Отзывы
7. **Payments** - Платежи
8. **Wallet Operations** - Операции кошелька партнеров

### Связи

```
Partners (1) ──→ (N) Locations
Partners (1) ──→ (N) Boards
Locations (1) ──→ (N) Boards
Boards (1) ──→ (N) Bookings
Users (1) ──→ (N) Bookings
Partners (1) ──→ (N) Wallet Operations
```

## 🔄 Партнерская система (как Яндекс Такси)

### Процесс подключения партнера

```
1. Регистрация партнера
   ↓
2. Модерация (админ проверяет)
   ↓
3. Активация аккаунта
   ↓
4. Добавление локаций и досок
   ↓
5. Начало приема бронирований
```

### Модель работы партнера

```
Партнер → Добавляет локацию → Добавляет доски → Получает бронирования
                                                      ↓
                                            Автоматическое начисление
                                                      ↓
                                            Вывод средств по запросу
```

### Комиссионная модель

- **Платформа**: 10% (настраивается)
- **Партнер**: 90% от суммы бронирования
- **Сотрудник партнера**: % от суммы партнера (настраивается)

## 🌐 Веб-сайт (как Авито)

### Главная страница

- **Hero-секция** с видео
- **Поиск по локациям** (карта + фильтры)
- **Популярные локации**
- **Преимущества платформы**
- **Отзывы**

### Страница локации

- **Карта с маркером**
- **Галерея фотографий**
- **Доступные доски** с ценами
- **Календарь доступности**
- **Отзывы о локации**
- **Кнопка бронирования**

### Страница бронирования

- **Многошаговая форма**:
  1. Выбор локации
  2. Выбор доски
  3. Дата и время
  4. Количество
  5. Контакты
  6. Оплата

### Личный кабинет пользователя

- **Мои бронирования**
- **История платежей**
- **Избранные локации**
- **Отзывы**

### Партнерский кабинет

- **Мои локации**
- **Мои доски**
- **Статистика бронирований**
- **Кошелек и выплаты**
- **Настройки профиля**

## 🔌 API для партнеров (будущее)

### Endpoints

```
POST   /api/v1/partners/register      - Регистрация
GET    /api/v1/partners/profile        - Профиль
PUT    /api/v1/partners/profile        - Обновление профиля

POST   /api/v1/partners/locations      - Добавить локацию
GET    /api/v1/partners/locations      - Список локаций
PUT    /api/v1/partners/locations/:id  - Обновить локацию

POST   /api/v1/partners/boards         - Добавить доску
GET    /api/v1/partners/boards         - Список досок
PUT    /api/v1/partners/boards/:id     - Обновить доску

GET    /api/v1/partners/bookings       - Бронирования
PUT    /api/v1/partners/bookings/:id   - Обновить статус

GET    /api/v1/partners/wallet         - Кошелек
POST   /api/v1/partners/withdraw       - Запрос на вывод
```

## 💳 Платежная система

### Сценарии оплаты

1. **Telegram Payments** (в боте)
   ```
   Пользователь → Бот → Telegram Payment → Подтверждение
   ```

2. **ЮKassa** (на сайте)
   ```
   Пользователь → Сайт → ЮKassa → Redirect → Webhook → Подтверждение
   ```

3. **СБП/QR** (альтернатива)
   ```
   Пользователь → Генерация QR → Оплата → Проверка статуса
   ```

### Распределение средств

```
Сумма бронирования: 1000₽
├─ Платформа (10%): 100₽
└─ Партнер (90%): 900₽
   └─ Сотрудник (если есть): % от 900₽
```

## 📱 Telegram Bot

### Основные сценарии

1. **Быстрое бронирование**
   - Выбор локации
   - Выбор доски
   - Дата/время
   - Оплата

2. **Суточная аренда (P2P)**
   - Выбор доски
   - Дата начала/конца
   - Оплата

3. **Мультибронирование**
   - Несколько досок одновременно
   - Групповые скидки

4. **Партнерский кабинет**
   - Управление локациями
   - Управление досками
   - Статистика
   - Кошелек

## 🔔 Система уведомлений

### Типы уведомлений

- **Новое бронирование** (партнеру)
- **Подтверждение бронирования** (пользователю)
- **Напоминание о бронировании** (за 24ч, 2ч)
- **Завершение бронирования** (автоматическое)
- **Выплата средств** (партнеру)

## 🗺️ Интеграция с картами

### Планируется

- **Яндекс.Карты API**
  - Отображение локаций
  - Поиск ближайших точек
  - Маршруты до локации

- **Google Maps API** (альтернатива)
  - Аналогичный функционал

## 📊 Аналитика

### Метрики для партнеров

- Количество бронирований
- Выручка
- Средний чек
- Конверсия
- Рейтинг

### Метрики для платформы

- Общее количество бронирований
- GMV (Gross Merchandise Value)
- Количество активных партнеров
- Количество активных пользователей
- Средний рейтинг платформы

## 🔐 Безопасность

- **Аутентификация**: Telegram ID, JWT для API
- **Авторизация**: Роли (user, partner, admin)
- **Платежи**: PCI DSS compliance через ЮKassa
- **Данные**: Шифрование чувствительных данных

## 🚀 Масштабирование

### Текущая архитектура (MVP)

- SQLite для разработки
- Flask для веб-сайта
- aiogram для бота
- Монолитная структура

### Будущая архитектура

- **PostgreSQL** для продакшена
- **Redis** для кеширования
- **Микросервисы**:
  - Booking Service
  - Payment Service
  - Partner Service
  - Notification Service
- **Message Queue** (RabbitMQ/Kafka)
- **CDN** для статики
- **Load Balancer**

## 📈 Roadmap развития

### Фаза 1: MVP (текущая)
- ✅ Telegram бот
- ✅ Базовый веб-сайт
- ✅ Партнерская система
- ✅ Платежи

### Фаза 2: Улучшения
- [ ] Полноценный веб-сайт с картами
- [ ] Мобильная версия
- [ ] API для партнеров
- [ ] Расширенная аналитика

### Фаза 3: Масштабирование
- [ ] Микросервисная архитектура
- [ ] Мобильное приложение
- [ ] Интеграция с социальными сетями
- [ ] Система лояльности

### Фаза 4: Экспансия
- [ ] Международные рынки
- [ ] Другие виды активного отдыха
- [ ] B2B решения
- [ ] Франшиза

